# Story 2.1: Form Builder UI Foundation

## Status

Draft

## Story

**As a** form builder,
**I want** a visual form builder interface with canvas and component palette,
**so that** I can drag and drop components to create forms.

## Acceptance Criteria

1. React application with form builder route/page
2. Split-screen layout: left sidebar (component palette), center (canvas), right sidebar (property panel)
3. Component palette with core components: Text Input, Number Input, Date Picker, Dropdown, Checkbox, Radio Button, Textarea, Button
4. Drag-and-drop functionality: components can be dragged from palette to canvas
5. Canvas displays form preview with dropped components
6. Component selection: clicking a component selects it and shows in property panel
7. Visual feedback: selected components show selection border/highlight
8. Delete functionality: selected components can be deleted
9. Undo/Redo functionality for form building actions
10. Responsive layout that works on desktop (minimum 1280px width)

## Tasks / Subtasks

- [ ] Task 1: Set Up React Application Structure (AC: 1)
  - [ ] Create apps/web-app/ directory structure
  - [ ] Initialize React + TypeScript project with Vite
  - [ ] Set up routing with React Router
  - [ ] Create form builder route/page (/form-builder)
  - [ ] Configure build tools and development server
  - [ ] Set up state management (Zustand or Redux Toolkit)

- [ ] Task 2: Create Split-Screen Layout (AC: 2)
  - [ ] Create main layout component with three sections
  - [ ] Left sidebar component (component palette)
  - [ ] Center canvas component (form preview area)
  - [ ] Right sidebar component (property panel)
  - [ ] Implement responsive CSS Grid or Flexbox layout
  - [ ] Add resizable panels (optional enhancement)
  - [ ] Ensure minimum 1280px width requirement

- [ ] Task 3: Implement Component Palette (AC: 3)
  - [ ] Create component palette UI with component list
  - [ ] Add Text Input component icon/button
  - [ ] Add Number Input component icon/button
  - [ ] Add Date Picker component icon/button
  - [ ] Add Dropdown component icon/button
  - [ ] Add Checkbox component icon/button
  - [ ] Add Radio Button component icon/button
  - [ ] Add Textarea component icon/button
  - [ ] Add Button component icon/button
  - [ ] Style component palette with icons and labels

- [ ] Task 4: Implement Drag-and-Drop Functionality (AC: 4)
  - [ ] Install and configure drag-and-drop library (react-dnd or dnd-kit)
  - [ ] Make component palette items draggable
  - [ ] Make canvas a drop zone
  - [ ] Handle drop events to add components to canvas
  - [ ] Generate unique IDs for dropped components
  - [ ] Update form state when components are dropped

- [ ] Task 5: Implement Canvas Form Preview (AC: 5)
  - [ ] Create canvas component that renders form components
  - [ ] Render dropped components in preview mode
  - [ ] Display form structure visually
  - [ ] Handle component positioning and layout
  - [ ] Support component reordering (drag within canvas)

- [ ] Task 6: Implement Component Selection (AC: 6)
  - [ ] Add click handler to canvas components
  - [ ] Update selected component state on click
  - [ ] Show selected component in property panel
  - [ ] Highlight selected component visually
  - [ ] Handle deselection (click outside or ESC key)

- [ ] Task 7: Implement Visual Feedback for Selection (AC: 7)
  - [ ] Add selection border/highlight CSS
  - [ ] Show selection indicator on selected component
  - [ ] Update visual state when component is selected
  - [ ] Clear selection visual when component is deselected

- [ ] Task 8: Implement Delete Functionality (AC: 8)
  - [ ] Add delete button/keyboard shortcut (Delete key)
  - [ ] Remove selected component from form state
  - [ ] Clear selection after deletion
  - [ ] Update canvas after component deletion

- [ ] Task 9: Implement Undo/Redo Functionality (AC: 9)
  - [ ] Create history/undo stack in state management
  - [ ] Save form state snapshots on each action
  - [ ] Implement undo action (Ctrl+Z)
  - [ ] Implement redo action (Ctrl+Y or Ctrl+Shift+Z)
  - [ ] Update UI to reflect undo/redo state
  - [ ] Limit history stack size (e.g., 50 actions)

- [ ] Task 10: Ensure Responsive Layout (AC: 10)
  - [ ] Test layout at 1280px width
  - [ ] Ensure all panels are visible and usable
  - [ ] Add responsive breakpoints if needed
  - [ ] Test on different screen sizes
  - [ ] Document minimum width requirements

## Dev Notes

### Previous Story Insights

From Story 1.3:
- Form Builder Service API is available for saving forms
- Form schema structure is JSON Schema format
- GraphQL Gateway will be available for querying forms

### Data Models

**Form Component Structure:**
```typescript
interface FormComponent {
  id: string;
  type: 'text' | 'number' | 'date' | 'dropdown' | 'checkbox' | 'radio' | 'textarea' | 'button';
  label: string;
  fieldName: string;
  properties: ComponentProperties;
  validation?: ValidationRules;
}

interface ComponentProperties {
  placeholder?: string;
  required?: boolean;
  defaultValue?: any;
  helpText?: string;
  // Type-specific properties
  maxLength?: number;
  min?: number;
  max?: number;
  options?: string[]; // For dropdown/radio
  // ... other properties
}
```

[Source: docs/front-end-spec.md#component-library]

### API Specifications

**Form Builder API (via GraphQL Gateway):**
- `mutation createForm(input: CreateFormInput!)` - Save form definition
- `query form(id: ID!)` - Get form by ID
- `mutation updateForm(id: ID!, input: UpdateFormInput!)` - Update form

[Source: docs/architecture.md#graphql-api-specification]

### File Locations

**Frontend Application Structure:**
```
apps/web-app/
├── src/
│   ├── pages/
│   │   └── FormBuilder/
│   │       ├── FormBuilderPage.tsx
│   │       ├── ComponentPalette.tsx
│   │       ├── FormCanvas.tsx
│   │       └── PropertyPanel.tsx
│   ├── components/
│   │   ├── form-components/
│   │   │   ├── TextInput.tsx
│   │   │   ├── NumberInput.tsx
│   │   │   ├── DatePicker.tsx
│   │   │   ├── Dropdown.tsx
│   │   │   ├── Checkbox.tsx
│   │   │   ├── RadioButton.tsx
│   │   │   ├── Textarea.tsx
│   │   │   └── Button.tsx
│   │   └── shared/
│   ├── stores/
│   │   └── formBuilderStore.ts        # Zustand store for form builder state
│   ├── hooks/
│   │   └── useFormBuilder.ts          # Custom hooks
│   ├── utils/
│   │   └── formSchemaGenerator.ts     # Generate JSON Schema from form components
│   └── App.tsx
├── package.json
└── vite.config.ts
```

[Source: docs/architecture/source-tree.md]

### Technical Constraints

**Technology Stack:**
- Frontend Framework: React 18+ with TypeScript [Source: docs/architecture/tech-stack.md]
- Build Tool: Vite [Source: docs/architecture/tech-stack.md]
- State Management: Zustand or Redux Toolkit [Source: docs/architecture/tech-stack.md]
- UI Library: Material-UI or Ant Design [Source: docs/architecture/tech-stack.md]
- Drag-and-Drop: react-dnd or @dnd-kit/core [Source: docs/front-end-spec.md]

**Design Requirements:**
- Follow Material Design or Ant Design patterns
- Responsive layout with minimum 1280px width
- Accessible components (WCAG AA compliance)
- Smooth animations and transitions

**Environment Variables Required:**
- `VITE_GRAPHQL_GATEWAY_URL` - GraphQL Gateway endpoint
- `VITE_AUTH_SERVICE_URL` - Auth Service endpoint (for authentication)

[Source: docs/architecture.md#development-workflow]

## Testing

### Testing Standards

**Test File Location:**
- Frontend unit tests: `apps/web-app/src/__tests__/` or `apps/web-app/src/**/*.test.tsx`
- Frontend component tests: `apps/web-app/src/components/**/*.test.tsx`

**Testing Frameworks:**
- Frontend: Vitest + React Testing Library [Source: docs/architecture/tech-stack.md]

**Testing Patterns:**
- Unit tests for form builder store/logic
- Component tests for UI components
- Integration tests for drag-and-drop functionality
- Test component selection and deletion
- Test undo/redo functionality

**Test Coverage Target:** >80% for business logic [Source: docs/architecture.md#testing-strategy]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-19 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent - will list all files created/modified during implementation_

## QA Results

_This section will be populated by the QA Agent after review_

