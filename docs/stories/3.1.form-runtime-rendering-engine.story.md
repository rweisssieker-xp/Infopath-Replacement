# Story 3.1: Form Runtime Rendering Engine

## Status

Draft

## Story

**As a** form user,
**I want** to view and fill out forms,
**so that** I can submit form data.

## Acceptance Criteria

1. Form runtime page/route that loads form by ID or slug
2. Form rendered from JSON Schema using react-jsonschema-form or custom renderer
3. All component types render correctly: Text Input, Number, Date, Dropdown, Checkbox, Radio, Textarea
4. Responsive layout: form adapts to screen size (mobile, tablet, desktop)
5. Form styling matches design system (consistent spacing, typography, colors)
6. Loading state: spinner while form schema loads
7. Error state: user-friendly error if form not found or access denied
8. Form header displays form name and description
9. Form footer with action buttons (Save Draft, Submit)
10. Accessibility: proper ARIA labels, keyboard navigation, focus management

## Tasks / Subtasks

- [ ] Task 1: Create Form Runtime Page/Route (AC: 1)
  - [ ] Create /form/:id route in React Router
  - [ ] Create /form/:slug route (alternative)
  - [ ] Create FormRuntimePage component
  - [ ] Handle route parameters (id or slug)
  - [ ] Add route protection (authentication required)

- [ ] Task 2: Implement Form Schema Loading (AC: 1, 6)
  - [ ] Fetch form schema from GraphQL Gateway or REST API
  - [ ] Handle loading state with spinner
  - [ ] Cache form schema for performance
  - [ ] Handle form not found error (404)
  - [ ] Handle access denied error (403)

- [ ] Task 3: Implement Form Renderer (AC: 2, 3)
  - [ ] Choose form rendering library (react-jsonschema-form or custom)
  - [ ] Create custom form renderer component
  - [ ] Map JSON Schema types to React components
  - [ ] Render Text Input component
  - [ ] Render Number Input component
  - [ ] Render Date Picker component
  - [ ] Render Dropdown component
  - [ ] Render Checkbox component
  - [ ] Render Radio Button component
  - [ ] Render Textarea component
  - [ ] Handle nested fields and sections

- [ ] Task 4: Implement Responsive Layout (AC: 4)
  - [ ] Add responsive CSS using breakpoints
  - [ ] Test on mobile devices (< 768px)
  - [ ] Test on tablet devices (768px - 1024px)
  - [ ] Test on desktop devices (> 1024px)
  - [ ] Ensure form fields stack vertically on mobile
  - [ ] Ensure proper spacing and padding on all screen sizes

- [ ] Task 5: Apply Design System Styling (AC: 5)
  - [ ] Use Material-UI or Ant Design theme
  - [ ] Apply consistent spacing (from design system)
  - [ ] Apply consistent typography (from design system)
  - [ ] Apply consistent colors (from design system)
  - [ ] Style form fields consistently
  - [ ] Style buttons consistently

- [ ] Task 6: Implement Loading and Error States (AC: 6, 7)
  - [ ] Show loading spinner while fetching form schema
  - [ ] Show error message if form not found
  - [ ] Show error message if access denied
  - [ ] Show error message for network errors
  - [ ] Provide retry option for failed loads
  - [ ] Style error messages consistently

- [ ] Task 7: Implement Form Header (AC: 8)
  - [ ] Display form name
  - [ ] Display form description (if available)
  - [ ] Style header consistently
  - [ ] Add breadcrumb navigation (optional)

- [ ] Task 8: Implement Form Footer with Actions (AC: 9)
  - [ ] Add "Save Draft" button
  - [ ] Add "Submit" button
  - [ ] Handle Save Draft action
  - [ ] Handle Submit action
  - [ ] Disable buttons during submission
  - [ ] Show loading state on buttons

- [ ] Task 9: Implement Accessibility Features (AC: 10)
  - [ ] Add ARIA labels to all form fields
  - [ ] Add ARIA labels to buttons
  - [ ] Implement keyboard navigation
  - [ ] Implement focus management
  - [ ] Ensure proper tab order
  - [ ] Add screen reader support
  - [ ] Test with screen reader

## Dev Notes

### Previous Story Insights

From Story 1.3:
- Form Builder Service API is available for fetching form schemas
- Form schema is stored in JSON Schema format

From Story 1.4:
- Form Runtime Service API is available for saving submissions
- Autosave functionality is implemented in backend

From Story 2.3:
- Form schema generation is implemented
- Forms can be saved and loaded

### Data Models

**Form Schema Structure:**
```typescript
interface FormSchema {
  type: 'object';
  properties: Record<string, JsonSchemaProperty>;
  required: string[];
  title?: string;
  description?: string;
}

interface JsonSchemaProperty {
  type: 'string' | 'number' | 'integer' | 'boolean' | 'array' | 'object';
  title?: string;
  description?: string;
  default?: any;
  enum?: any[];
  format?: 'email' | 'date' | 'date-time' | 'uri';
  pattern?: string;
  minLength?: number;
  maxLength?: number;
  minimum?: number;
  maximum?: number;
  // ... other JSON Schema properties
}
```

[Source: docs/architecture.md#data-models]

### API Specifications

**Form Loading (GraphQL Gateway):**
```graphql
query Form($id: ID!) {
  form(id: $id) {
    id
    name
    description
    schema
    version
    status
  }
}
```

**Form Submission (GraphQL Gateway or REST):**
```graphql
mutation CreateSubmission($input: CreateSubmissionInput!) {
  createSubmission(input: $input) {
    id
    status
  }
}
```

[Source: docs/architecture.md#graphql-api-specification]

### File Locations

**Frontend Application Structure:**
```
apps/web-app/src/
├── pages/
│   └── FormRuntime/
│       ├── FormRuntimePage.tsx
│       ├── FormRenderer.tsx
│       └── FormFieldRenderer.tsx
├── components/
│   └── form-runtime/
│       ├── TextInputField.tsx
│       ├── NumberInputField.tsx
│       ├── DatePickerField.tsx
│       ├── DropdownField.tsx
│       ├── CheckboxField.tsx
│       ├── RadioField.tsx
│       └── TextareaField.tsx
├── hooks/
│   └── useFormRuntime.ts
└── services/
    └── formRuntimeService.ts
```

[Source: docs/architecture/source-tree.md]

### Technical Constraints

**Technology Stack:**
- Frontend Framework: React 18+ with TypeScript [Source: docs/architecture/tech-stack.md]
- Form Rendering: react-jsonschema-form or custom renderer [Source: docs/front-end-spec.md]
- UI Library: Material-UI or Ant Design [Source: docs/architecture/tech-stack.md]
- State Management: Zustand or Redux Toolkit [Source: docs/architecture/tech-stack.md]

**Design Requirements:**
- Follow Material Design or Ant Design patterns
- Responsive layout with mobile-first approach
- Accessible components (WCAG AA compliance)
- Consistent styling with design system

**Environment Variables Required:**
- `VITE_GRAPHQL_GATEWAY_URL` - GraphQL Gateway endpoint
- `VITE_AUTH_SERVICE_URL` - Auth Service endpoint (for authentication)

[Source: docs/architecture.md#development-workflow]

## Testing

### Testing Standards

**Test File Location:**
- Frontend unit tests: `apps/web-app/src/pages/FormRuntime/__tests__/`
- Component tests: `apps/web-app/src/components/form-runtime/__tests__/`

**Testing Frameworks:**
- Frontend: Vitest + React Testing Library [Source: docs/architecture/tech-stack.md]

**Testing Patterns:**
- Unit tests for form renderer logic
- Component tests for form field components
- Integration tests for form loading and submission
- Test responsive layout
- Test accessibility features
- Test error handling

**Test Coverage Target:** >80% for business logic [Source: docs/architecture.md#testing-strategy]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-19 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent - will list all files created/modified during implementation_

## QA Results

_This section will be populated by the QA Agent after review_

