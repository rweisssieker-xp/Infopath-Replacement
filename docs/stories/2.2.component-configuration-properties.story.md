# Story 2.2: Component Configuration and Properties

## Status

Draft

## Story

**As a** form builder,
**I want** to configure component properties,
**so that** I can customize form fields according to requirements.

## Acceptance Criteria

1. Property panel displays when component is selected
2. Common properties editable: Label, Field Name, Placeholder, Required, Default Value, Help Text
3. Type-specific properties:
   - Text Input: Max Length, Pattern (regex), Input Type (text, email, tel, url)
   - Number Input: Min, Max, Step, Number Format
   - Date Picker: Date Format, Min Date, Max Date
   - Dropdown: Options list (add/remove/edit options)
   - Textarea: Rows, Max Length
4. Changes in property panel immediately reflect in canvas preview
5. Validation: Field Name must be unique within form, must match identifier pattern
6. Property panel shows validation errors for invalid inputs
7. Reset to default functionality for properties
8. Copy/paste component functionality (duplicates component with same properties)

## Tasks / Subtasks

- [ ] Task 1: Implement Property Panel Display Logic (AC: 1)
  - [ ] Show property panel when component is selected
  - [ ] Hide property panel when no component is selected
  - [ ] Display component type and basic info in panel header
  - [ ] Handle panel state in form builder store

- [ ] Task 2: Implement Common Properties Editor (AC: 2)
  - [ ] Create Label input field
  - [ ] Create Field Name input field
  - [ ] Create Placeholder input field
  - [ ] Create Required checkbox
  - [ ] Create Default Value input field
  - [ ] Create Help Text textarea
  - [ ] Wire up property changes to form state

- [ ] Task 3: Implement Type-Specific Properties (AC: 3)
  - [ ] Create Text Input properties editor (Max Length, Pattern, Input Type)
  - [ ] Create Number Input properties editor (Min, Max, Step, Format)
  - [ ] Create Date Picker properties editor (Date Format, Min Date, Max Date)
  - [ ] Create Dropdown properties editor (Options list management)
  - [ ] Create Textarea properties editor (Rows, Max Length)
  - [ ] Show/hide type-specific properties based on component type

- [ ] Task 4: Implement Live Preview Updates (AC: 4)
  - [ ] Update canvas component when property changes
  - [ ] Use React state updates for immediate reflection
  - [ ] Optimize re-renders for performance
  - [ ] Ensure smooth property editing experience

- [ ] Task 5: Implement Field Name Validation (AC: 5)
  - [ ] Validate field name uniqueness within form
  - [ ] Validate field name matches identifier pattern (alphanumeric + underscore)
  - [ ] Show validation errors in property panel
  - [ ] Prevent saving form with invalid field names
  - [ ] Auto-generate field name from label if not provided

- [ ] Task 6: Implement Property Input Validation (AC: 6)
  - [ ] Validate numeric inputs (min, max, step)
  - [ ] Validate regex pattern syntax
  - [ ] Validate date formats
  - [ ] Show inline validation errors
  - [ ] Highlight invalid fields

- [ ] Task 7: Implement Reset to Default Functionality (AC: 7)
  - [ ] Add "Reset to Default" button in property panel
  - [ ] Store default property values for each component type
  - [ ] Reset component properties to defaults
  - [ ] Update canvas preview after reset

- [ ] Task 8: Implement Copy/Paste Component Functionality (AC: 8)
  - [ ] Add copy button/keyboard shortcut (Ctrl+C)
  - [ ] Store component data in clipboard
  - [ ] Add paste button/keyboard shortcut (Ctrl+V)
  - [ ] Create new component with copied properties
  - [ ] Generate new unique ID for pasted component
  - [ ] Update field name to ensure uniqueness

## Dev Notes

### Previous Story Insights

From Story 2.1:
- Form Builder UI Foundation is implemented
- Component palette and canvas are functional
- Component selection is working
- Form builder store manages form state

### Data Models

**Component Properties Structure:**
```typescript
interface ComponentProperties {
  // Common properties
  label: string;
  fieldName: string;
  placeholder?: string;
  required: boolean;
  defaultValue?: any;
  helpText?: string;
  
  // Type-specific properties
  // Text Input
  maxLength?: number;
  pattern?: string;
  inputType?: 'text' | 'email' | 'tel' | 'url';
  
  // Number Input
  min?: number;
  max?: number;
  step?: number;
  numberFormat?: string;
  
  // Date Picker
  dateFormat?: string;
  minDate?: string;
  maxDate?: string;
  
  // Dropdown/Radio
  options?: string[];
  
  // Textarea
  rows?: number;
}
```

[Source: docs/front-end-spec.md#component-library]

### File Locations

**Property Panel Component:**
```
apps/web-app/src/pages/FormBuilder/
├── PropertyPanel.tsx              # Main property panel component
├── PropertyEditors/
│   ├── CommonPropertiesEditor.tsx
│   ├── TextInputPropertiesEditor.tsx
│   ├── NumberInputPropertiesEditor.tsx
│   ├── DatePickerPropertiesEditor.tsx
│   ├── DropdownPropertiesEditor.tsx
│   └── TextareaPropertiesEditor.tsx
└── utils/
    └── propertyValidators.ts      # Validation utilities
```

[Source: docs/architecture/source-tree.md]

### Technical Constraints

**Technology Stack:**
- Frontend Framework: React 18+ with TypeScript [Source: docs/architecture/tech-stack.md]
- UI Library: Material-UI or Ant Design [Source: docs/architecture/tech-stack.md]
- Form Validation: React Hook Form + Zod or Yup [Source: docs/architecture/tech-stack.md]

**Validation Rules:**
- Field Name: Must be unique, match pattern `^[a-zA-Z][a-zA-Z0-9_]*$`
- Max Length: Must be positive integer
- Min/Max: Min must be <= Max
- Regex Pattern: Must be valid regex syntax
- Date Format: Must be valid date format string

**Environment Variables Required:**
- None specific to this story

[Source: docs/architecture.md#development-workflow]

## Testing

### Testing Standards

**Test File Location:**
- Frontend unit tests: `apps/web-app/src/pages/FormBuilder/__tests__/`
- Component tests: `apps/web-app/src/pages/FormBuilder/PropertyEditors/**/*.test.tsx`

**Testing Frameworks:**
- Frontend: Vitest + React Testing Library [Source: docs/architecture/tech-stack.md]

**Testing Patterns:**
- Unit tests for property validators
- Component tests for property editors
- Integration tests for property updates
- Test field name uniqueness validation
- Test copy/paste functionality

**Test Coverage Target:** >80% for business logic [Source: docs/architecture.md#testing-strategy]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-19 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent - will list all files created/modified during implementation_

## QA Results

_This section will be populated by the QA Agent after review_

